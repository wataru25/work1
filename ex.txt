Function Implied_Vol(weight As Range)

    Dim i As Integer
    Dim j As Integer
    Dim colnum As Integer
    Dim Return_Data As Range
    Dim Cov() As Double
    Dim Vol As Double
    
    Set Return_Data = Sheet1.Range("B2:G26")
    
    colnum = 6
    ReDim Cov(colnum - 1, colnum - 1)
    Vol = 0
    For i = 1 To colnum
        For j = 1 To colnum
        Cov(i - 1, j - 1) = WorksheetFunction.Covariance_S(Return_Data.Columns(i), Return_Data.Columns(j))
        Vol = Vol + Cov(i - 1, j - 1) * weight.Cells(i, 1) * weight.Cells(j, 1)
        Next j
    Next i
    
    Implied_Vol = Sqr(Vol)
        


End Function